\documentclass[a4paper,11pt,notitlepage]{report}
% Henrik Lund Kramshoej, February 2001
% hlk@security6.net,
% My standard packages
\usepackage{zencurity-network-exercises}

\begin{document}

\rm
\selectlanguage{english}

\newcommand{\emne}[1]{Computer Systems Security workshop}
\newcommand{\kursus}[1]{Computer Systems Security workshop}
\newcommand{\kursusnavn}[1]{Computer Systems Security workshop\\ exercises}

\mytitle{Computer Systems Security}{exercises}

\pagenumbering{roman}


\setcounter{tocdepth}{0}

\normal

{\color{titlecolor}\tableofcontents}
%\listoffigures - not used
%\listoftables - not used

\normal
\pagestyle{fancyplain}
\chapter*{\color{titlecolor}Preface}
\markboth{Preface}{}

This material is prepared for use in \emph{\kursus} and was prepared by
Henrik Lund Kramshoej, \link{http://www.zencurity.com} .
It describes the networking setup and
applications for trainings and workshops where hands-on exercises are needed.

\vskip 1cm
Further a presentation is used which is available as PDF from kramse@Github\\
Look for \jobname in the repo security-courses.

These exercises are expected to be performed in a training setting with network connected systems. The exercises use a number of tools which can be copied and reused after training. A lot is described about setting up your workstation in the repo

\link{https://github.com/kramse/kramse-labs}



\section*{\color{titlecolor}Prerequisites}

This material expect that participants have a working knowledge of
TCP/IP from a user perspective. Basic concepts such as web site addresses and email should be known as well as IP-addresses and common protocols like DHCP.

\vskip 1cm
Have fun and learn
\eject

% =================== body of the document ===============
% Arabic page numbers
\pagenumbering{arabic}
\rhead{\fancyplain{}{\bf \chaptername\ \thechapter}}

% Main chapters
%---------------------------------------------------------------------
% gennemgang af emnet
% check questions

\chapter*{\color{titlecolor}Exercise content}
\markboth{Exercise content}{}

Most exercises follow the same procedure and has the following content:
\begin{itemize}
\item {\bf Objective:} What is the exercise about, the objective
\item {\bf Purpose:} What is to be the expected outcome and goal of doing this exercise
\item {\bf Suggested method:} suggest a way to get started
\item {\bf Hints:} one or more hints and tips or even description how to
do the actual exercises
\item {\bf Solution:} one possible solution is specified
\item {\bf Discussion:} Further things to note about the exercises, things to remember and discuss
\end{itemize}

Please note that the method and contents are similar to real life scenarios and does not detail every step of doing the exercises. Entering commands directly from a book only teaches typing, while the exercises are designed to help you become able to learn and actually research solutions.


\chapter{Download Kali Linux Revealed (KLR) Book 10 min}
\label{ex:downloadKLR}


\hlkimage{3cm}{kali-linux-revealed.jpg}

\emph{Kali Linux Revealed  Mastering the Penetration Testing Distribution}


{\bf Objective:}\\
We need a Kali Linux for running tools during the course. This is open source, and the developers have released a whole book about running Kali Linux.

This is named Kali Linux Revealed (KLR)

{\bf Purpose:}\\
We need to install Kali Linux in a few moments, so better have the instructions ready.

{\bf Suggested method:}\\
Create folders for educational materials. Go to \link{https://www.kali.org/download-kali-linux-revealed-book/}
Read and follow the instructions for downloading the book.

{\bf Solution:}\\
When you have a directory structure for download for this course, and the book KLR in PDF you are done.

{\bf Discussion:}\\
Linux is free and everywhere. The tools we will run in this course are made for Unix, so they run great on Linux.

Kali Linux is a free pentesting platform, and probably worth more than \$10.000

The book KLR is free, but you can buy/donate, and I recommend it.

\chapter{Check your Kali VM, run Kali Linux 30 min}
\label{ex:basicVM}

\hlkimage{10cm}{kali-linux.png}

{\bf Objective:}\\
Make sure your virtual machine is in working order.

We need a Kali Linux for running tools during the course.

{\bf Purpose:}\\
If your VM is not installed and updated we will run into trouble later.

{\bf Suggested method:}\\
Go to \link{https://github.com/kramse/kramse-labs/}

Read the instructions for the setup of a Kali VM.

{\bf Hints:}\\
If you allocate enough memory and disk you wont have problems.

{\bf Solution:}\\
When you have a updated virtualisation software and Kali Linux, then we are good.

{\bf Discussion:}\\
Linux is free and everywhere. The tools we will run in this course are made for Unix, so they run great on Linux.

Kali Linux includes many hacker tools and should be known by anyone working in infosec.

\chapter{Check your Debian VM 10 min}
\label{ex:basicDebianVM}

\hlkimage{3cm}{debian-9.png}

{\bf Objective:}\\
Make sure your virtual Debian 9 machine is in working order.

We need a Debian 9 Linux for running a few extra tools during the course.

{\Large \bf This is a bonus exercise - only one Debian is needed per team.}

{\bf Purpose:}\\
If your VM is not installed and updated we will run into trouble later.

{\bf Suggested method:}\\
Go to \link{https://github.com/kramse/kramse-labs/}

Read the instructions for the setup of a Kali VM.

{\bf Hints:}\\

{\bf Solution:}\\
When you have a updated virtualisation software and Kali Linux, then we are good.

{\bf Discussion:}\\
Linux is free and everywhere. The tools we will run in this course are made for Unix, so they run great on Linux.



\chapter{Investigate /etc 10 min}
\label{ex:basicLinuxetc}


{\bf Objective:}\\
We will investigate the /etc directory on Linux

We need a Debian 9 Linux and a Kali Linux, to compare


{\bf Purpose:}\\
Start seeing example configuration files, including:
\begin{itemize}
  \item User database \verb+/etc/passwd+ and \verb+/etc/group+
  \item The password database \verb+/etc/shadow+
\end{itemize}

{\bf Suggested method:}\\
Boot your Linux VMs, log in

Investigate permissions for the user database files \verb+passwd+ and \verb+shadow+

{\bf Hints:}\\
Linux has many tools for viewing files, the most efficient would be less.

\begin{alltt}
hlk@debian:~$ cd /etc
hlk@debian:/etc$ ls -l shadow passwd
-rw-r--r-- 1 root root   2203 Mar 26 17:27 passwd
-rw-r----- 1 root shadow 1250 Mar 26 17:27 shadow
hlk@debian:/etc$ ls
... all files and directories shown, investigate more if you like
\end{alltt}

Showing a single file: \verb+less /etc/passwd+ and press q to quit

Showing multiple files: \verb+less /etc/*+ then :n for next and q for quit

\begin{alltt}
Trying reading the shadow file as your regular user:
user@debian-9-lab:/etc$ cat /etc/shadow
cat: /etc/shadow: Permission denied
\end{alltt}

Why is that? Try switching to root, using su or sudo, and redo the command.

{\bf Solution:}\\
When you have seen the most basic files you are done.

{\bf Discussion:}\\
Linux is free and everywhere. The tools we will run in this course are made for Unix, so they run great on Linux.



\chapter{Discover active systems ping sweep 10 min}
\label{ex:nmap-pingsweep}
\hlkimage{5cm}{nmap-zenmap.png}

{\bf Objective:}\\
Use nmap to discover active systems

{\bf Purpose:}\\
Know how to use nmap to scan networks for active systems.

{\bf Suggested method:}\\
Try different scans,
\begin{itemize}
\item Ping sweep to find active systems
\item Port sweeps to find active systems with specific ports
\end{itemize}

{\bf Hints:} \\
Try nmap in sweep mode - and you may run this from Zenmap

{\bf Solution:}\\
Use the command below as examples:
\begin{itemize}
\item Ping sweep \verb+nmap -sP 10.0.45.*+
\item Port sweeps \verb+nmap -p 80 10.0.45.*+
\end{itemize}

{\bf Discussion:}\\
Quick scans quickly reveal interesting hosts, ports and services

Also now make sure you understand difference between single host scan
10.0.45.123/32, a whole subnet /24 ~250 hosts 10.0.45.0/24 and other more advanced targeteting like 10.0.45.0/25 and 10.0.45.1-10


\chapter{Execute nmap TCP and UDP port scan 20 min}
\label{ex:nmap-synscan}


{\bf Objective:} \\
Use nmap to discover important open ports on active systems

{\bf Purpose:}\\
Finding open ports will allow you to find vulnerabilities on these ports.

{\bf Suggested method:}\\
Use \verb+nmap -p 1-1024 server+ to scan the first 1024 TCP
ports and use Nmap without ports. What is scanned then?

Try to use \verb+nmap -sU+ to scan using UDP ports, not really possible if a firewall is in place.

If a firewall blocks ICMP you might need to add \verb+-Pn+ to make nmap scan even if there are no Ping responses

{\bf Hints:} \\
Sample command: \verb+nmap -Pn -sU -p1-1024 server+ UDP port scanning
1024 ports without doing a Ping first

{\bf Solution:}\\
Discover some active systems and most interesting ports, which are 1-1024 and the built-in list of popular ports.

{\bf Discussion:}\\
There is a lot of documentation about the nmap portscanner, even a book by the author
of nmap. Make sure to visit \link{http://www.nmap.org}

TCP and UDP is very different when scanning. TCP is connection/flow oriented and requires a handshake which is very easy to identify. UDP does not have a handshake and most applications will not respond to probes from nmap. If there is no firewall the operating system will respond to UDP probes on closed ports - and the ones that do not respond must be open.

When doing UDP scan on the internet you will almost never get a response, so you cannot tell open (not responding services) from blocked ports (firewall drop packets). Instead try using specific service programs for the services, sample program could be \verb+nsping+ which sends DNS packets, and will often get a response from a DNS server running on UDP port 53.

\chapter{Perform nmap OS detection 10 min}
\label{ex:nmap-os}

{\bf Objective:} \\
Use nmap OS detection and see if you can guess the brand of devices on the network

{\bf Purpose:}\\
Getting the operating system of a system will allow you to focus your next attacks.

{\bf Suggested method:}\\
Look at the list of active systems, or do a ping sweep.

Then add the OS detection using the option \verb+-O+

Better to use -A all the time, includes even more scripts and advanced stuff
See the next exercise.

{\bf Hints:} \\
The nmap can send a lot of packets that will get different responses, depending on the operating system. TCP/IP is implemented using various constants chosen by the implementors, they have chosen different standard packet TTL etc.

{\bf Solution:}\\
Use a command like \verb+nmap -O -p1-100 10.0.45.45+ or  \verb+nmap -A -p1-100 10.0.45.45+


{\bf Discussion:}\\
nmap OS detection is not a full proof way of knowing the actual operating system, but in most cases in can detect the family and in some cases it can identify the exact patch level of the system.




\chapter{Run Armitage - Hail Mary 30min}
\label{ex:hail-mary}

{\bf Objective:}\\
Try hacking using a graphical program, see how quick and easy it can be.

{\bf Purpose:}\\
Show that when a vulnerability exist attacks can be quick and easy.

{\bf Suggested method:}\\

Running Armitage as a gui on top of Metasploit is the easiest way to do this.

\begin{enumerate}
\item Boot up Kali Linux
\item Boot up Metasploitable - from ISO\\
There may be a couple of systems already running this.
\item Run Armitage Hail-Mary against Metasploitable
\item Note which succeeded, describe those attacks that succeeded in relation to MITRE ATT\&CK framework
\end{enumerate}

{\bf Hints:}\\
Running Metasploit against Metasploitable - which is a vulnerable system - should result in multiple vulnerabilities exploited.

Each of these may have different characteristics.

We are aiming at:
\begin{itemize}
\item Vulnerable application - root access
\item Vulnerable application - non-root access, would need privilege escalation
\item Bad password allowing \emph{Brute Force} access, msfadmin/msfadmin - see also \emph{Valid Accounts}
\end{itemize}


{\bf Solution:}\\
When you have exploited and mapped at least one vulnerability you are done, but should spend more time.

{\bf Discussion:}\\
Do we need these frameworks? What are the benefits? - can we become product blind - so we only see what these framework cover.


\chapter{SELinux Introduction up to 60min}
\label{ex:se-linux-intro}

{\bf Objective:}\\
Check out the SELinux system\\
\link{https://www.debian.org/doc/manuals/debian-handbook/sect.selinux.en.html}

and the setup instructions at:\\
\link{https://wiki.debian.org/SELinux/Setup}

(Not working right now - Create a secret file, that you can read, but root cant.)

{\bf Purpose:}\\
Everybody reads about Discretionary Access Control (DAC) and Mandatory Access Control (MAC) but few realize that Linux implements it.


{\bf Suggested method:}\\
Try enabling and disabling the policies in your Debian VM.

First install prerequisites - approx 75MB download on my system:\\
\verb+apt-get install selinux-basics selinux-policy-default auditd+

Then run activation of SELinux:\\
\verb+selinux-activate+

\begin{alltt}
  root@debian-9-lab:~# selinux-activate
  Activating SE Linux
  Generating grub configuration file ...
  Found linux image: /boot/vmlinuz-4.9.0-9-amd64
  Found initrd image: /boot/initrd.img-4.9.0-9-amd64
  Found linux image: /boot/vmlinuz-4.9.0-8-amd64
  Found initrd image: /boot/initrd.img-4.9.0-8-amd64
  done
  SE Linux is activated.  You may need to reboot now.
  root@debian-9-lab:~#
\end{alltt}

Perform the reboot, \verb+shutdown -r now+ then check again.

Not enabled will show this, try again:
\begin{alltt}
root@debian-9-lab:~# sestatus
SELinux status:                 disabled
\end{alltt}

Enabled, but not the current mode and mode from config file discrepancy:
\begin{alltt}
root@debian:~# sestatus
SELinux status:                 enabled
SELinuxfs mount:                /sys/fs/selinux
SELinux root directory:         /etc/selinux
Loaded policy name:             default
Current mode:                   {\bf enforcing}
Mode from config file:          {\bf permissive}
Policy MLS status:              enabled
Policy deny_unknown status:     allowed
Max kernel policy version:      30
\end{alltt}

While playing I had changed the mode temporarily to \emph{enforcing}! Next reboot would make SELinux run in the more \emph{permissive} mode

\subsection{Part 2 - do this when SELinux is enabled}

Create a directory and a test file:
\begin{alltt}
root@debian:~# setenforce 0   // set mode permissive!
root@debian:~# cd
root@debian:~# mkdir /etc/private
root@debian:~# echo "hey" > /etc/private/README
root@debian:~# cat /etc/private/README
hey
root@debian:~#
\end{alltt}

Root can read the file, yay!

Copy example files:
\begin{alltt}
cp -r /usr/share/doc/selinux-policy-dev/examples .
cd examples/

\end{alltt}

Create a file myprivate.te with this content:
\begin{alltt}
policy_module(myprivate, 1.0)

########################################
#
# Declarations
#
type etc_private_t;
fs_associate(etc_private_t)

type sysadm_t;
type sysadm_exec_t;

userdom_admin_user_template(sysadm_t)

allow sysadm_t etc_private_t:{dir file} relabelto;
\end{alltt}

Note last line is missing a sysadm domain, does not work.

Then compile using this: \verb+make myprivate.pp+
\begin{alltt}
root@debian:~/examples# make myprivate.pp
Compiling default myprivate module
/usr/bin/checkmodule:  loading policy configuration from tmp/myprivate.tmp
/usr/bin/checkmodule:  policy configuration loaded
/usr/bin/checkmodule:  writing binary representation (version 17) to tmp/myprivate.mod
Creating default myprivate.pp policy package
rm tmp/myprivate.mod.fc tmp/myprivate.mod
root@debian:~/examples#
\end{alltt}

then it should have been possible to enable/disable enforcing mode, and see the file becoming unreadable - even by root.

Something is wrong, when enabling enforcing mode, the chcon command fails:
\begin{alltt}
root@debian:~/examples# setenforce 1
root@debian:~/examples# chcon -R -t etc_private_t /etc/private/README
chcon: failed to change context of '/etc/private/README' to ‘system_u:object_r:etc_private_t:s0’: Invalid argument
root@debian:~/examples# chcon -R -t etc_private_t /etc/private
chcon: failed to change context of 'README' to ‘system_u:object_r:etc_private_t:s0’: Invalid argument
chcon: failed to change context of '/etc/private' to ‘system_u:object_r:etc_private_t:s0’: Invalid argument

root@debian:~/examples# setenforce 0
root@debian:~/examples# chcon -R -t etc_private_t /etc/private/README
root@debian:~/examples#
// When Linux returns to the command prompt without messages no errors were observed
\end{alltt}

So SELinux IS preventing us from doing it :-D

this example is in parts based on this blog post:\\
\link{http://blog.siphos.be/2015/07/restricting-even-root-access-to-a-folder/}


{\bf Hints:}\\
Keeping SELinux enabled may NOT be a good idea, since some tools may not work correctly, until policies are downloaded, written or installed.

Temporarily disable SELinux:\\
\verb+echo 0 > /sys/fs/selinux/enforce+

Temporarily enable SELinux:\\
\verb+echo 1 > /sys/fs/selinux/enforce+

or use the command \verb+setenforce 0+ or
\verb+setenforce 1+

The main config for setting permissive or enforcing mode is
\verb+/etc/selinux/config+:
\begin{alltt}
root@debian-9-lab:~# cat /etc/selinux/config
# This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
# enforcing - SELinux security policy is enforced.
# permissive - SELinux prints warnings instead of enforcing.
# disabled - No SELinux policy is loaded.
SELINUX=permissive
# SELINUXTYPE= can take one of these two values:
# default - equivalent to the old strict and targeted policies
# mls     - Multi-Level Security (for military and educational use)
# src     - Custom policy built from source
SELINUXTYPE=default

# SETLOCALDEFS= Check local definition changes
SETLOCALDEFS=0
\end{alltt}


{\bf Solution:}\\
%When you have a small text file which you can read, but root cannot, you are done.
When you have enabled and seen the commands used, you are done.

It is easy to have multiple hours disappear when working with SELinux.

{\bf Discussion:}\\
Yes, the root user can disable the SELinux protection :-D

I had Firefox crash at least once during this exercise, so beware - fancy and bigger applications may crash when using this!

\chapter{Example AUPs up to 30min}
\label{ex:example-AUP}

{\bf Objective:}\\
See real world high level policies

{\bf Purpose:}\\
When writing your first policy it may be hard to know what to include. Starting from an example is often easier.

{\bf Suggested method:}\\
Find your AUP for the ISPs we use, you use, your company uses.

{\bf Hints:}\\
Policies for different environments are often very different in scope and goals.

Book mentions military and commercial, but an ISP, University and a commercial enterprise have very different methods and requirements.

Example, how do you handle BYOD Bring your own devices, University you expect students to bring them, in a secure enterprise only company devices may be allowed.

{\bf Solution:}\\
When you have seen at least two different policies you are done.

{\bf Discussion:}\\
How do you both write AND create awareness about a policy?

\chapter{SYN flooding 101}
\label{ex:syn-flood-101}

{\bf Objective:}\\
Start a webserver attack using SYN flooding tool hping3.

{\bf Purpose:}\\
See how easy it is to produce packets on a network using hacker programs.

The tool we will use is very flexible and can produce ICMP, UDP and TCP using very few options.

\begin{alltt}\footnotesize
-1 --icmp
       ICMP  mode,  by  default  hping3  will  send  ICMP echo-request, you can set other ICMP
       type/code using --icmptype --icmpcode options.

-2 --udp
       UDP mode, by default hping3 will send udp to target host's port 0.  UDP header  tunable
       options are the following: --baseport, --destport, --keep.
\end{alltt}

TCP mode is default, so no option needed.


{\bf Suggested method:}\\
Connect to the LAB network using Ethernet! Borrow a USB network card if you dont have one.

Start your Kali VM in bridged mode, try a basic TCP flooding attack against the server provided by the instructor, or your own Debian server.

\begin{alltt}\footnotesize
hping3 --flood -p 80 10.0.45.12
\end{alltt}

You should see something like this:
\begin{alltt}\footnotesize
HPING 10.0.45.12: NO FLAGS are set, 40 headers + 0 data bytes
hping in flood mode, no replies will be shown
^C
--- 10.0.45.12 hping statistic ---
352339 packets transmitted, 0 packets received, 100% packet loss
round-trip min/avg/max = 0.0/0.0/0.0 ms
\end{alltt}

Try doing the most common attacks, RTFM hping3:
\begin{itemize}
\item ICMP flooding
\item UDP flooding, try port 53 and port 123
\item TCP flooding, try port 22 or port 80 on your debian perhaps
\end{itemize}


{\bf Hints:}\\
The tool we use can do a lot of different things, and you can control the speed. You can measure at the server being attacked or what you are sending, commonly using ifpps or such programs can help.

This allows you to use the tool to test devices and find the breaking point, which is more interesting than if you can overload, because you always can.
\begin{alltt}\footnotesize
-i --interval
       Wait  the  specified  number  of  seconds or micro seconds between sending each packet.
       --interval X set wait to X seconds, --interval uX set wait to X micro seconds.  The de‐
       fault  is  to  wait one second between each packet. Using hping3 to transfer files tune
       this option is really important in order to increase transfer rate. Even  using  hping3
       to  perform  idle/spoofing  scanning  you should tune this option, see HPING3-HOWTO for
       more information.

--fast Alias for -i u10000. Hping will send 10 packets for second.

--faster
       Alias for -i u1. Faster then --fast ;) (but not as fast as your computer can send pack‐
       ets due to the signal-driven design).

--flood
       Sent  packets  as fast as possible, without taking care to show incoming replies.  This
       is ways faster than to specify the -i u0 option.
\end{alltt}

{\bf Solution:}\\
When your team has sent +1 million packets per second into the network, from one or two laptops - you are done.

{\bf Discussion:}\\
Gigabit Ethernet can send up to 1.4 million packets per second, pps.

There is a presentation about DDoS protection with low level technical measures to implement at\\
{\footnotesize \link{https://github.com/kramse/security-courses/tree/master/presentations/network/introduction-ddos-testing}}





\chapter{RBAC Access permissions on GitHub 30-45min}
\label{ex:github-perms}

{\bf Objective:}\\
See actual real life example of permissions.

Note: This exercise requires a GitHub account, so make sure your group has one. Maybe do groups of 3-4 for more discussion.

{\bf Purpose:}\\
GitHub is a very popular code sharing site.

{\bf Suggested method:}\\
Go to GitHub web page:\\
\link{https://help.github.com/en/articles/access-permissions-on-github}

Follow links to other pages, like:\\
\link{https://help.github.com/en/articles/permission-levels-for-an-organization}


{\bf Hints:}\\
Some might already have an account on GitHub - maybe work through adding a repository and adding collaborators.

If you have an organisation, even better.

{\bf Solution:}\\
When you have discussed GitHub permissions and played with a repository you are done.

{\bf Discussion:}\\
The internet is decentralized, but recent years see more centralization - GitHub, DNS Google DNS, Cloudflare.

What are some problems in this?



\chapter{SSL/TLS scanners 15 min}
\label{ex:sslscan}

{\bf Objective:}\\
Try the Online Qualys SSLLabs scanner \link{https://www.ssllabs.com/}
Try the command line tool sslscan checking servers - can check both HTTPS and non-HTTPS protocols!

{\bf Purpose:}\\
Learn how to efficiently check TLS settings on remote services.

{\bf Suggested method:}\\
Run the tool against a couple of sites of your choice.

\begin{alltt}\small
root@kali:~# sslscan --ssl2 web.kramse.dk
Version: 1.10.5-static
OpenSSL 1.0.2e-dev xx XXX xxxx

Testing SSL server web.kramse.dk on port 443
...
  SSL Certificate:
Signature Algorithm: sha256WithRSAEncryption
RSA Key Strength:    2048

Subject:  *.kramse.dk
Altnames: DNS:*.kramse.dk, DNS:kramse.dk
Issuer:   AlphaSSL CA - SHA256 - G2
\end{alltt}

Also run it without \verb+--ssl2+ and against SMTPTLS if possible.

{\bf Hints:}\\
Originally sslscan is from \link{http://www.titania.co.uk} but use the version on Kali, install with apt if not installed.

{\bf Solution:}\\
When you can run and understand what the tool does, you are done.

{\bf Discussion:}\\
SSLscan can check your own sites, while Qualys SSLLabs only can test from hostname



\chapter{Nmap Ikescan IPsec}
\label{ex:nmap-ikescan}

{\bf Objective:}\\
Try Nmap and Ikescan

{\bf Purpose:}\\


{\bf Suggested method:}\\


{\bf Hints:}\\


{\bf Solution:}\\


{\bf Discussion:}\\


\chapter{SSH scanners}
\label{ex:nmap-ssh-scanner}

{\bf Objective:}\\

 Try ssh scanners, similar to sslscan and Nmap sshscan

{\bf Purpose:}\\


{\bf Suggested method:}\\


{\bf Hints:}\\


{\bf Solution:}\\


{\bf Discussion:}\\


\chapter{Password Cracking}
\label{ex:pwcrack-101}

{\bf Objective:}\\

Crack your own passwords
{\bf Purpose:}\\


{\bf Suggested method:}\\


{\bf Hints:}\\


{\bf Solution:}\\


{\bf Discussion:}\\


\chapter{Perform privilege escalation using files 30min}
\label{ex:priv-esc-cron}

{\bf Objective:}\\
Perform a simple privilege escalation attack

{\bf Purpose:}\\
Try and test a back door script.

{\bf Suggested method:}\\

\begin{enumerate}
\item Make a non-privileged user
\item make a system directory writable
\item create root cronjob without path
\item Insert a malicious script as one of the commands from the root cron job
\end{enumerate}

{\bf Hints:}\\
A cron job runs scheduled commands. They usually perform cleanup functions, removing old files, doing a backup or similar

In this exercise first try out the malicious commands for creating a back door shell program. Login in as root, then:

\begin{alltt}
root@debian:~# rm /tmp/.xxsh
root@debian:~# cp /bin/dash /tmp/.xxsh
root@debian:~# chmod +sw /tmp/.xxsh
\end{alltt}

Then test using a normal user, another window:
\begin{alltt}
hlk@debian:~$ /tmp/.xxsh
# id
uid=1000(hlk) gid=1000(hlk) {\bf euid=0(root) egid=0(root)} groups=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),112(lpadmin),117(scanner),1000(hlk) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
#
\end{alltt}

The effective user id should be 0 which is root.

When this manual process work. Then automate it, make it into a script like in the book. Imagine if the root user was running automated scripts, and you could add yours to a directory used in the PATH for these automated ones.

This happens in a lot of devices and hosts today.

The main takeaway is that root scripts should ALWAYS have a PATH defined, and ALL directories used by root script should only be writable by root!

{\bf Solution:}\\
When you have created the script for doing the shell copy you are done.

Further advanced steps would be to add this into some PATH writable by you, and letting a cron job escalate.

 Then do a cron job that uses this command - a cron job running every 5 minutes using the \verb+ls+ command and introduce your malicious script by putting it before the real command in the PATH.



{\bf Discussion:}\\
This was chosen as I found a similar vulnerability in a professional product, in 2019


\chapter{Anti-virus and "endpoint security" 20min}
\label{ex:anti-virus-end-point-security}

{\bf Objective:}\\
Discuss when to use Anti-virus and "endpoint security"

{\bf Purpose:}\\
Anti-virus programs have been shown to catch some viruses, useful.

Anti-virus programs have been shown to be insecure programs that also slows down systems, counter-productive and increases target surface and exposure.

{\bf Suggested method:}\\
Sit in groups 3-5 -- discuss among yourselves. Write down plus and minus for using anti-virus -- especially which use-cases should use AV, and which shouldn't.

{\bf Hints:}\\
In some cases people have installed AV products for check-mark security, the check-list said to have AV, so we installed a mail scanner on this web server -- bad security.

{\bf Solution:}\\
When we have done a collected talk and discussion we are done.

{\bf Discussion:}\\
I dont use anti-virus products at all. I do use a lot of backup though.

Which is more trust-worthy - a restored system or a system cleaned by random anti-virus program?






\chapter{Email Security 2019}
\label{ex:email-security}

{\bf Objective:}\\
Talk and plan roll-out of security mechanisms based on DNS records. Domain Name System. Check you personal domain and domain used for work. If you are new to this I suggest experimenting with your own personal domain, or create one.

{\bf Purpose:}\\
Make sure everyone attending know about methods to restrict sending of false emails, how to secure this using DNSSEC, SPF, DMARC - DNS based updates to your email domain security


{\bf Email security 2019 - Goals}

\begin{itemize}
\item SPF Sender Policy Framework\\ {\footnotesize\url{https://en.wikipedia.org/wiki/Sender_Policy_Framework}}
\item DKIM DomainKeys Identified Mail\\
{\footnotesize\url{https://en.wikipedia.org/wiki/DomainKeys_Identified_Mail}}
\item DMARC Domain-based Message Authentication, Reporting and Conformance\\
{\footnotesize\url{https://en.wikipedia.org/wiki/DMARC}}
\item DANE DNS-based Authentication of Named Entities\\ {\footnotesize\url{https://en.wikipedia.org/wiki/DNS-based_Authentication_of_Named_Entities}}
\item Brug allesammen, check efter ændringer!
\end{itemize}

DNS-based Authentication of Named Entities (dane)
\begin{quote}
"TLSA records store hashes of remote server TLS/SSL certificates. The authenticity of a TLS/SSL certificate for a domain name is verified by DANE protocol (RFC 6698). DNSSEC and TLSA validation results are displayer by using several icons."
\end{quote}


{\bf Suggested method:}\\
Use services on the internet, such as \link{https://internet.nl/} and \link{https://dmarcian.com/} to see current status for your domains.

{\bf Hints:}\\
I suggest the following strategy when you implement these methods, if you dare do it right now. If you make a plan.

{\bf Basic mail security 2019}
\begin{enumerate}
\item Implement DNSSEC - turn it on, most likely easy
\item Configure Sender Policy Framework, perhaps only \verb+~all+ tilde means soft fail
\item Configure DomainKeys Identified Mail
\item Configure receiving email address for DMARC
\item Configure Domain-based Message Authentication - reject none
\end{enumerate}

Spend some time trying different tools for DMARC reporting. A month or a week, depending on the domain and your users. Github alone has 100s of projects concerned with parsing, reporting and working with DMARC.

Then after some time has passed, and you have reviewed reporting from DMARC, turn it on for real:
\begin{enumerate}
\item Configure SPF to disallow with hard fail use \verb+-all+ minus
\item Configure DMARC with reject - reject emails not following policy
\end{enumerate}

{\bf Advanced mail security 2019}
\begin{enumerate}
\item Create real certificates for DANE
\item Publish them \smiley
\end{enumerate}

Helpful hints from \link{https://blog.apnic.net/2017/01/06/lets-encrypt-dane/}


{\bf Solution:}\\
When the internet is ridden of falsified spam you are done \smiley\ - its up to you.

{\bf Discussion:}\\
You need to research before making changes to important domains.

If you have domains that \emph{never send email} then add the following SPF and DMARC to avoid misuse.

from my own DSN template for \emph{parked domains}:
\begin{alltt}
gdns.template	v=spf1 -all	43200
_dmarc.gdns.template	v=DMARC1; p=reject;	43200
\end{alltt}

\end{document}

\chapter{VM escapes}
\label{ex:vm-escape}

{\bf Objective:}\\


{\bf Purpose:}\\
Research VM escapes

{\bf Suggested method:}\\


{\bf Hints:}\\


{\bf Solution:}\\


{\bf Discussion:}\\





\chapter{Centralized syslog}
\label{ex:centralized-syslog-practical}

{\bf Objective:}\\

Centralized syslogging and example system

{\bf Purpose:}\\


{\bf Suggested method:}\\


{\bf Hints:}\\


{\bf Solution:}\\


{\bf Discussion:}\\


\chapter{File System Forensics}
\label{ex:file-system-forensics}

{\bf Objective:}\\

 Open a file system dump
{\bf Purpose:}\\


{\bf Suggested method:}\\


{\bf Hints:}\\


{\bf Solution:}\\


{\bf Discussion:}\\



\chapter{Clean or rebuild a server}
\label{ex:clean-or-rebuild}

{\bf Objective:}\\


{\bf Purpose:}\\


{\bf Suggested method:}\\


{\bf Hints:}\\


{\bf Solution:}\\


{\bf Discussion:}\\


\chapter{Cloud environments influence on incident response}
\label{ex:cloud-incident-response}

{\bf Objective:}\\


{\bf Purpose:}\\


{\bf Suggested method:}\\


{\bf Hints:}\\


{\bf Solution:}\\


{\bf Discussion:}\\





\chapter{System Security in Practice}
\label{ex:system-security-practice}

{\bf Objective:}\\


{\bf Purpose:}\\


{\bf Suggested method:}\\

\begin{itemize}
\item Work on our model network, each team has a router and an attacker - prevent most of the attacks on the Metasploitable server by firewall configuration
\item Investigate Debian as a server - default settings for Web, we will install a system which requires database and web server configured
\item Configure SSH keys
\end{itemize}

{\bf Hints:}\\


{\bf Solution:}\\


{\bf Discussion:}\\





\chapter{Evaluate our network PCI}
\label{ex:PCI-evaluation}

{\bf Objective:}\\
Evaluate our network, quick gap analysis for becoming PCI compliant

{\bf Purpose:}\\


{\bf Suggested method:}\\


{\bf Hints:}\\


{\bf Solution:}\\


{\bf Discussion:}\\

\end{document}
