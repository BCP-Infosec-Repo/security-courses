\documentclass[a4paper,11pt,notitlepage]{report}
% Henrik Lund Kramshoej, February 2001
% hlk@security6.net,
% My standard packages
\usepackage{zencurity-network-exercises}

\begin{document}

\rm
\selectlanguage{english}

\newcommand{\emne}[1]{hacker workshop}
\newcommand{\kursus}[1]{ethical hacker workshop}
\newcommand{\kursusnavn}[1]{ethical hacker workshop\\ exercises}

\mytitle{Nmap Hackerworkshop}{exercises}

\pagenumbering{roman}


\setcounter{tocdepth}{0}

\normal

{\color{titlecolor}\tableofcontents}
%\listoffigures - not used
%\listoftables - not used

\normal
\pagestyle{fancyplain}
\chapter*{\color{titlecolor}Preface}
\markboth{Preface}{}

This material is prepared for use in \emph{\kursus} and was prepared by
Henrik Lund Kramshoej, \link{http://www.zencurity.com} .
It describes the networking setup and
applications for trainings and workshops where hands-on exercises are needed.

\vskip 1cm
Further a presentation is used which is available as PDF from kramse@Github\\
Look for \jobname in the repo security-courses.

These exercises are expected to be performed in a training setting with network connected systems. The exercises use a number of tools which can be copied and reused after training. A lot is described about setting up your workstation in the repo

\url{https://github.com/kramse/kramse-labs}



\section*{\color{titlecolor}Prerequisites}

This material expect that participants have a working knowledge of
TCP/IP from a user perspective. Basic concepts such as web site addresses and email should be known as well as IP-addresses and common protocols like DHCP.

\vskip 1cm
Have fun and learn
\eject

% =================== body of the document ===============
% Arabic page numbers
\pagenumbering{arabic}
\rhead{\fancyplain{}{\bf \chaptername\ \thechapter}}

% Main chapters
%---------------------------------------------------------------------
% gennemgang af emnet
% check questions


\chapter*{\color{titlecolor}Introduction to networking}
%\markboth{Introduktion til netv√¶rk}{}
\label{chap:intro}

\section*{\color{titlecolor}IP - Internet protocol suite}

It is extremely important to have a working knowledge about IP to implement
secure and robust infrastructures. Knowing about the alternatives while doing
implementation will allow the selection of the best features.

\section*{\color{titlecolor}ISO/OSI reference model}
A very famous model used for describing networking is the ISO/OSI model
of networking which describes layering of network protocols in stacks.

This model divides the problem of communicating into layers which can
then solve the problem as smaller individual problems and the solution
later combined to provide networking.

Having layering has proven also in real life to be helpful, for instance
replacing older hardware technologies with new and more efficient technologies
without changing the upper layers.

In the picture the OSI reference model is shown along side with
the Internet Protocol suite model which can also be considered to have different layers.


\begin{figure}[H]
\label{fig:osi}
\begin{center}
\colorbox{white}{\includegraphics[width=8cm,angle=90]{images/compare-osi-ip.pdf}}
\end{center}
\caption{OSI og Internet Protocol suite}
\end{figure}


\chapter*{\color{titlecolor}Exercise content}
\markboth{Exercise content}{}

Most exercises follow the same procedure and has the following content:
\begin{itemize}
\item {\bf Objective:} What is the exercise about, the objective
\item {\bf Purpose:} What is to be the expected outcome and goal of doing this exercise
\item {\bf Suggested method:} suggest a way to get started
\item {\bf Hints:} one or more hints and tips or even description how to
do the actual exercises
\item {\bf Solution:} one possible solution is specified
\item {\bf Discussion:} Further things to note about the exercises, things to remember and discuss
\end{itemize}

Please note that the method and contents are similar to real life scenarios and does not detail every step of doing the exercises. Entering commands directly from a book only teaches typing, while the exercises are designed to help you become able to learn and actually research solutions.



\chapter{Wireshark and tcpdump}
\label{ex:wireshark-install}

\hlkimage{10cm}{wireshark-http.png}


{\bf Objective:}\\
Try the program Wireshark locally your workstation, or tcpdump

If you already have Kali installed you have Wireshark. Done.

{\bf Purpose:}\\
Installing Wireshark will allow you to analyse packets and protocols

Tcpdump is a feature included in many operating systems and devices to allow packet capture and saving network traffic into files.

{\bf Suggested method:}\\
Download and install the program, either download from web server locally or from \link{http://www.wireshark.org}\\
Wireshark requires a packet capture library to be installed

{\bf Hints:}\\
PCAP is a packet capture library allowing you to read packets from the network.
Tcpdump uses libpcap library to read packet from the network cards and save them.
Wireshark is a graphical application to allow you to browse through traffic, packets and protocols.

{\bf Solution:}\\
When Wireshark is installed sniff some packets. We will be working with both live traffic and saved packets from files in this course.

{\bf Discussion:}\\
Wireshark is just an example other packet analyzers exist, some commercial and some open source like Wireshark

We can download a lot of packet traces, we might use examples from 
\url{https://www.bro.org/community/traces.html}

\chapter{Capturing network packets}
\label{ex:wireshark-capture}

\hlkimage{4cm}{tcp-three-way.pdf}


{\bf Objective:}\\
Sniff packets and dissect them using Wireshark

{\bf Purpose:}\\
See real network traffic, also know that a lot of information is available and not encrypted.

Note the three way handshake between hosts

{\bf Suggested method:}\\
Open Wireshark and start a capture\\
Then in another window execute the ping program while sniffing

or perform a Telnet connection while capturing data

{\bf Hints:}\\
When running on Linux the network cards are usually named eth0 for the first Ethernet and wlan0 for the first Wireless network card. In Windows the names of the network cards are long and if you cannot see which cards to use then try them one by one.

{\bf Solution:}\\
When you have collected some packets you are done.

{\bf Discussion:}
Is it ethical to collect packets from an open wireless network?

Also note the TTL values in packets from different operating systems




\chapter{Bro on the web}
\label{ex:broweb}


{\bf Objective:} \\



{\bf Purpose:}\\
Show a couple of examples of Bro scripting, the built-in language


{\bf Suggested method:}\\

Go to \url{http://try.bro.org/#/?example=hello}

{\bf Hints:}\\
The exercise
\emph{The Summary Statistics Framework} can be run with a specifc PCAP.

\begin{alltt}
192.168.1.201 did 402 total and 2 unique DNS requests in the last 6 hours.
\end{alltt}

{\bf Solution:}\\
You should read the example \emph{Raising a Notice}. Getting output for certain events may be interesting to you.


{\bf Discussion:}\\




\chapter{Bro DNS capturing domain names}
\label{ex:brodnsbasic}


{\bf Objective:} \\



{\bf Purpose:}\\



{\bf Suggested method:}\\



{\bf Hints:}\\



{\bf Solution:}\\



{\bf Discussion:}\\




\chapter{Bro TLS capturing certificates}
\label{ex:brotlsbasic}


{\bf Objective:} \\



{\bf Purpose:}\\



{\bf Suggested method:}\\



{\bf Hints:}\\



{\bf Solution:}\\



{\bf Discussion:}\\




\chapter{Suricata Basic Operation}
\label{ex:suricatastartstop}


{\bf Objective:} \\



{\bf Purpose:}\\



{\bf Suggested method:}\\


{\bf Hints:}\\
\url{https://redmine.openinfosecfoundation.org/projects/suricata/wiki/Quick_Start_Guide}
and
\url{https://redmine.openinfosecfoundation.org/projects/suricata/wiki/Basic_Setup}

{\bf Solution:}\\



{\bf Discussion:}\\




\chapter{Basic Suricata configuration}
\label{ex:suricataeve1}


{\bf Objective:} \\
See the Suricata configuration files, and turn on EVE log.


{\bf Purpose:}\\



{\bf Suggested method:}\\

Open the Suricata config file suricata.yml and make sure eve-log is turned on.
https://suricata.readthedocs.io/en/suricata-4.0.5/output/eve/eve-json-output.html
\begin{alltt}
# Extensible Event Format (nicknamed EVE) event log in JSON format
- eve-log:
    enabled: yes
\end{alltt}

{\bf Hints:}\\



{\bf Solution:}\\



{\bf Discussion:}\\




\chapter{Configure Mirror Port}
\label{ex:mirrorport}


{\bf Objective:} \\
Mirror ports are a way to copy traffic to Suricata and other devices - for analyzing it. We will go through the steps on a Juniper switch to show how.

Most switches which are configurable have this possibility.


{\bf Purpose:}\\



{\bf Suggested method:}\\



{\bf Hints:}\\
When checking your own devices this is often called

\url{https://en.wikipedia.org/wiki/Port_mirroring}

Cisco has called this Switched Port Analyzer (SPAN) or Remote Switched Port Analyzer (RSPAN), so many will refer to them as SPAN-ports.

{\bf Solution:}\\



{\bf Discussion:}\\



\chapter{Save Suricata Output in Database}
\label{ex:suricatahasboards}


{\bf Objective:} \\
Configure a system to read the output files from Suricata EVE logging and save into database system.

This will enable us to use browser based methods and dashboards to analyse more efficiently.


{\bf Purpose:}\\



{\bf Suggested method:}\\



{\bf Hints:}\\



{\bf Solution:}\\



{\bf Discussion:}\\




\chapter{Suricata Netflow}
\label{ex:suricatanetflow}


{\bf Objective:} \\
Configure Suricata to do netflow logging


{\bf Purpose:}\\
In some cases we dont know what traffic we need to analyze, but if we collect netflow data - summary data about every connection. We can go back and check for specific types of traffic, based on ports, length etc.


{\bf Suggested method:}\\



{\bf Hints:}\\



{\bf Solution:}\\



{\bf Discussion:}\\




\chapter{Bro JSON}
\label{ex:brojson}


{\bf Objective:} \\
Turning back to Bro wouldn't it be nice to have that data in a database.


{\bf Purpose:}\\



{\bf Suggested method:}\\



{\bf Hints:}\\



{\bf Solution:}\\



{\bf Discussion:}\\




\chapter{Extending Bro and Suricata}
\label{ex:}


{\bf Objective:} \\
Sometimes Bro and Suricata by themselves will not be enough.

Investigate how to extend Bro and Suricata, by some examples.

{\bf Purpose:}\\



{\bf Suggested method:}\\
Get a patch from Henrik for VXLAN support in Suricata. The patch does not need to be installed, but how big is it, how complex is it, could you or your organisation to something similar?

Bro scripts extend the basic engine, and are a big part of the eco-system. Some 1000s of script lines are already included. Do you have a specific need to analyze in your network which could be implemented in this?

{\bf Hints:}\\
Earlier it was quite hard to write C programs for creating and analyzing network traffic. Today we can use the Bro scripting and Suricata rules to analyze traffic using highly efficient engines.


{\bf Solution:}\\



{\bf Discussion:}\\




\chapter{Indicators of Compromise}
\label{ex:broioc}


{\bf Objective:} \\
Indicators of Compromise is a term used for artifacts observed in networks or systems which indicate that a system was compromised.

This could be a known DNS domain where a specifc malware is downloaded from, a specific file name downloaded, a TCP connection to a malware control and command server.

\url{https://en.wikipedia.org/wiki/Indicator_of_compromise}

{\bf Purpose:}\\
The purpose of this exercice is to look at the data gathered and to start planning how one could use this with IOCs to perform after-the-fact analysis of your network.

Goal is to answer how an attack got in, when was the first device compromised etc.


{\bf Suggested method:}\\



{\bf Hints:}\\



{\bf Solution:}\\



{\bf Discussion:}\\

Bro can include data from other sources, check the intel module
\url{https://www.bro.org/sphinx/frameworks/intel.html}

and the exercise \url{https://www.bro.org/current/exercises/intel/index.html}

\chapter{VXLAN Detection}
\label{ex:vxlandetect}


{\bf Objective:} \\
One recent addition to many networks are cloud environments using tunneling and encapsulation to connect islands of containers and virtual systems.

One such protocol named VXLAN can be used without the network people being involved, which can be bad for security. Also it would be easy for an attacker which have compromised a system to use this for exfiltration of data.

So, do you have any VXLAN traffic in your network?


{\bf Purpose:}\\



{\bf Suggested method:}\\
VXLAN traffic will most likely use the default port 4789, which is not used by much other traffic.

VXLAN is also UDP packets, so analysing if a few endpoints use a LOT of UDP might reveal interesting stuff.


{\bf Hints:}\\
The conn.log might show you interesting things about such traffic.


{\bf Solution:}\\



{\bf Discussion:}\\



\appendix
\rhead{\fancyplain{}{\bf \leftmark}}
%\setlength{\parskip}{5pt}

\normal

\chapter{\color{titlecolor}Host information}

\begin{itemize}
\item You should note the IP-addresses used for servers and devices
\item The web server for installing programs:\\
http:// \hskip 15mm .\hskip 15mm .\hskip 15mm .\hskip 15mm
/public/windows/
\item Server used for team login: \hskip 15mm .\hskip 15mm .\hskip 15mm .\hskip 15mm \\
Available usernames: team1, team2, ... team10
password: \verb+team+
\item You can obtain root access using: \verb+sudo -s+
\end{itemize}

\section*{\color{titlecolor}Available servers and devices:}
\begin{itemize}
\item IP: \hskip 15mm .\hskip 15mm .\hskip 15mm .\hskip 15mm - OpenBSD router
\item IP: \hskip 15mm .\hskip 15mm .\hskip 15mm .\hskip 15mm - Your laptop
\item IP: \hskip 15mm .\hskip 15mm .\hskip 15mm .\hskip 15mm - Your laptop VM
\item IP: \hskip 15mm .\hskip 15mm .\hskip 15mm .\hskip 15mm -
\item IP: \hskip 15mm .\hskip 15mm .\hskip 15mm .\hskip 15mm -
\end{itemize}


\bibliographystyle{alpha}
%\bibliography{../ipv6-reference/security6-net.bib,../ipv6-reference/rfc.bib,../ipv6-reference/std.bib,../ipv6-reference/fyi.bib}
\bibliography{kramse.bib,rfc.bib,std.bib,fyi.bib}
%,internet.bib}


%\printindex

\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
