\documentclass[Screen16to9,17pt]{foils}
\usepackage{zencurity-slides}

\externaldocument{communication-and-network-security-exercises}
\selectlanguage{english}

\begin{document}

\mytitlepage
{4. Encrypting the Network}
{Communication and Network Security 2019}


\slide{Plan for today}

\begin{list1}
\item Subjects
\begin{list2}
\item Basic cryptography
\item Encryption Decryption
\item Hashing
\item Short introduction to algorithms RSA, AES
\item Diffie Helman exchange
\item Transport Layer Security (TLS)
\end{list2}
\item Exercises
\begin{list2}
\item mitmproxy \link{https://mitmproxy.org/}
\item sslsplit \link{https://www.roe.ch/SSLsplit}
\item sslstrip \link{https://moxie.org/software/sslstrip/}
\item \link{https://www.ssllabs.com/} and sslscan checking servers
\end{list2}
\end{list1}


\slide{Reading Summary, continued}

\begin{alltt}\footnotesize
Skim:\\
\link{https://tools.ietf.org/html/rfc5246} The Transport Layer Security (TLS) Protocol Version 1.2\\
\link{https://en.wikipedia.org/wiki/Transport_Layer_Security}
\end{alltt}

\begin{list1}
\item
\begin{list2}
\item
\end{list2}
\end{list1}


\slide{Reading Summary, continued}

\begin{quote}
It is not clear that the link layer is the right one for security. In a coffeeshop, the security association is terminated by the store: is there any reason you should trust the shopkeeper? Perhaps link-layer security makes some sense in a home, where you control both the access point and the wireless machines. However, we prefer end-to-end security at the network layer or in the
applications.
\end{quote} Source: Cheswick-chap2.pdf Firewalls and Internet Security: Repelling the Wily Hacker , Second Edition, William R. Cheswick, Steven M. Bellovin, and Aviel D. Rubin

\begin{list1}
\item
\begin{list2}
\item
\end{list2}
\end{list1}





\slide{kryptering, OpenPGP}

\begin{list1}
  \item kryptering er den eneste måde at sikre:
    \begin{list2}
      \item fortrolighed
      \item autenticitet
    \end{list2}
\item kryptering består af:
  \begin{list2}
    \item Algoritmer - eksempelvis RSA
    \item \emph{protokoller} - måden de bruges på
\item programmer - eksempelvis PGP
\end{list2}
\item fejl eller sårbarheder i en af komponenterne kan formindske
  sikkerheden
\item PGP = mail sikkerhed, se eksempelvis Enigmail plugin til Mozilla Thunderbird

\end{list1}

\slide{PGP/GPG verifikation af integriteten}

\begin{list1}
\item Pretty Good Privacy PGP
\item Gnu Privacy Guard GPG
\item Begge understøtter OpenPGP - fra IETF RFC-2440
\item Når man har hentet og verificeret en nøgle kan man fremover nemt
checke integriteten af software pakker
\end{list1}


\begin{alltt}
\small
hlk@bigfoot:postfix$ gpg --verify  postfix-2.1.5.tar.gz.sig
gpg: Signature made Wed Sep 15 17:36:03 2004 CEST using RSA key ID D5327CB9
gpg: Good signature from "wietse venema <wietse@porcupine.org>"
gpg:                 aka "wietse venema <wietse@wzv.win.tue.nl>"
\end{alltt}
%$

\slide{SSL og TLS}

\hlkimage{12cm}{ehandel-https.pdf}

\begin{list1}
\item Oprindeligt udviklet af Netscape Communications Inc.
\item Secure Sockets Layer SSL er idag blevet adopteret af IETF og kaldes
derfor også for Transport Layer Security TLS
TLS er baseret på SSL Version 3.0
\item RFC-2246 The TLS Protocol Version 1.0 fra Januar 1999
\end{list1}

\slide{SSL/TLS udgaver af protokoller}
\hlkimage{12cm}{imap-ssl.png}

\begin{list1}
\item Mange protokoller findes i udgaver hvor der benyttes SSL
\item HTTPS vs HTTP
\item IMAPS, POP3S, osv.
\item Bemærk: nogle protokoller benytter to porte IMAP 143/tcp vs IMAPS 993/tcp
\item Andre benytter den samme port men en kommando som starter:
\item SMTP STARTTLS RFC-3207
\end{list1}

\slide{Secure Shell - SSH og SCP}

%\begin{center}
%\colorbox{white}{\includegraphics[width=12cm]{images/tshirt-9b.jpg}}
%\end{center}

\hlkimage{13cm}{images/openssh-banner.png}

\begin{list1}
\item Hvad er Secure Shell SSH?
\item Oprindeligt udviklet af Tatu Ylönen i Finland,\\
se \link{http://www.ssh.com}
\item SSH afløser en række protokoller som er usikre:
  \begin{list2}
  \item Telnet til terminal adgang
  \item r* programmerne, rsh, rcp, rlogin, ...
  \item FTP med brugerid/password
  \end{list2}
\end{list1}


\slide{SSH - de nye kommandoer er}
\begin{list1}
\item kommandoerne er:
\begin{list2}
  \item ssh - Secure Shell
  \item scp - Secure Copy
  \item sftp - secure FTP
  \end{list2}
\item Husk: SSH er både navnet på protokollerne - version 1 og 2 samt
  programmet \verb+ssh+ til at logge ind på andre systemer
\item SSH tillader også port-forward, tunnel til usikre protokoller,
  eksempelvis X protokollen til UNIX grafiske vinduer
\item {\bfseries NB: Man bør idag bruge SSH protokol version 2!}
\end{list1}


\slide{SSH nøgler}

I praksis benytter man nøgler fremfor kodeord
\begin{list1}
\item I kan lave jeres egne SSH nøgler med programmerne i Putty
\item Hvilken del skal jeg have for at kunne give jer adgang til en
  server?
\item Hvordan får jeg smartest denne nøgle?
\end{list1}

\slide{Installation af SSH nøgle}
\begin{list1}
\item Vi bruger login med password på kurset, men for
  fuldstændighedens skyld beskrives her hvordan nøgle installeres:

\begin{list2}
\item først skal der genereres et nøglepar {\bfseries id\_dsa og id\_dsa.pub}
\item Den offentlige del, filen id\_dsa.pub, kopieres til serveren
\item Der logges ind på serveren
\item Der udføres følgende kommandoer:
\end{list2}
\end{list1}
\begin{alltt}
$ cd  \emph{skift til dit hjemmekatalog}
$ mkdir .ssh  \emph{lav et katalog til ssh-nøgler}
$ cat id\_dsa.pub >> .ssh/authorized\_keys  \emph{kopierer nøglen}
$ chmod -R go-rwx .ssh  \emph{skift rettigheder på nøglen}
\end{alltt}


\slide{OpenSSH konfiguration}

\begin{list1}
\item Sådan anbefaler jeg at konfigurere OpenSSH SSHD
\item Det gøres i filen \verb+sshd_config+ typisk \verb+/etc/ssh/sshd_config+
\end{list1}

\begin{alltt}\small
Port 22780    // eller anden tilfældig port
Protocol 2

PermitRootLogin no
PubkeyAuthentication yes
# To disable tunneled clear text passwords, change to no here!
PasswordAuthentication no

UseDNS no
#X11Forwarding no
#X11DisplayOffset 10
#X11UseLocalhost yes
\end{alltt}

Det er en smagssag om man vil tillade \emph{X11 forwarding}






\slide{IPsec}

\begin{itemize}
\item Sikkerhed i netværket
\item RFC-2401 Security Architecture for the Internet Protocol
\item RFC-2402 IP Authentication Header (AH)
\item RFC-2406 IP Encapsulating Security Payload (ESP)
\item RFC-2409 The Internet Key Exchange (IKE) - dynamisk keying
\item Både til IPv4 og IPv6
\item {\bfseries MANDATORY} i IPv6! - et krav hvis man implementerer
  fuld IPv6 support
\item god præsentation på \link{http://www.hsc.fr/presentations/ike/}
\item Der findes IKEscan til at scanne efter IKE
  porte/implementationer\\
\link{http://www.nta-monitor.com/ike-scan/index.htm}
\end{itemize}

\slide{IPsec er ikke simpelt!}

\hlkimage{16cm}{images/ipsec-hsc.png}
\centerline{Kilde: \link{http://www.hsc.fr/presentations/ike/}}


\slide{RFC-2402 IP AH}

\begin{alltt}
\small
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Next Header   |  Payload Len  |          RESERVED             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                 Security Parameters Index (SPI)               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Sequence Number Field                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                Authentication Data (variable)                 |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\end{alltt}

\slide{RFC-2402 IP AH}

Indpakning - pakkerne før og efter Authentication Header:
\begin{alltt}
\small
                BEFORE APPLYING AH
            ----------------------------
      IPv4  |orig IP hdr  |     |      |
            |(any options)| TCP | Data |
            ----------------------------

                  AFTER APPLYING AH
            ---------------------------------
      IPv4  |orig IP hdr  |    |     |      |
            |(any options)| AH | TCP | Data |
            ---------------------------------
            |<------- authenticated ------->|
                 except for mutable fields
\end{alltt}

\slide{RFC-2406 IP ESP}

Pakkerne før og efter:
\begin{alltt}
\small
               BEFORE APPLYING ESP
         ---------------------------------------
   IPv6  |             | ext hdrs |     |      |
         | orig IP hdr |if present| TCP | Data |
         ---------------------------------------



               AFTER APPLYING ESP
         ---------------------------------------------------------
   IPv6  | orig |hop-by-hop,dest*,|   |dest|   |    | ESP   | ESP|
         |IP hdr|routing,fragment.|ESP|opt*|TCP|Data|Trailer|Auth|
         ---------------------------------------------------------
                                   |<---- encrypted ---->|
                               |<---- authenticated ---->|
\end{alltt}

\slide{ipsec konfigurationsfiler}

\begin{list1}
%\item Der er følgende dokumenter til IPsec på websitet\\
% \link{www.security.net/courses/ipsec}:
\item Der er følgende filer tilgængelige\\
  \begin{list2}
  \item konfigurationsfiler i NetBSD/FreeBSD/Mac OS X format - med
    \verb+setkey+ kommandoen
  \item konfigurationsfil til OpenBSD server - med \verb+ipsecadm+
    kommandoen
%  \item IKE.pdf \emph{Dynamic Management of the IPsec Parameters:
%      The IKE Protocol}, fra Herve Schauer Consultants
%\item NetBSD IPsec dokumentation
%\item Cisco \emph{Introduction to IP security}
  \end{list2}
\end{list1}


\slide{World Wide Web fødes}

\hlkimage{15cm}{images/tim-berners-lee-2001-europaeum-eighth.jpg}

\begin{list1}
\item Tim Berners-Lee opfinder WWW 1989 og den første webbrowser og
  server i 1990 mens han arbejder for CERN
\end{list1}

Kilde:
\link{http://www.w3.org/People/Berners-Lee/}

\slide{World Wide Web udviklingen}

\hlkimage{20cm}{images/Count_WWW.png}

\begin{list1}
\item Udviklingen på world wide web bliver en stor kommerciel success
\end{list1}

Kilde: Hobbes Internet time-line\\
\link{http://www.zakon.org/robert/internet/timeline/}

\slide{Nogle HTTP og webrelaterede RFC'er}

\begin{list2}
\item[1945] Hypertext Transfer Protocol -- HTTP/1.0. T. Berners-Lee, R.
     Fielding, H. Frystyk. May 1996.
\item[2068] Hypertext Transfer Protocol -- HTTP/1.1. R. Fielding, J. Gettys,
     J. Mogul, H. Frystyk, T. Berners-Lee. January 1997. (Obsoleted by
     RFC2616)
\item[2069] An Extension to HTTP : Digest Access Authentication. J. Franks,
     P. Hallam-Baker, J. Hostetler, P. Leach, A. Luotonen, E. Sink, L.
     Stewart. January 1997. (Obsoleted by
     RFC2617)
\item[2145] Use and Interpretation of HTTP Version Numbers. J. C. Mogul, R.
     Fielding, J. Gettys, H. Frystyk. May 1997.
\item[2518] HTTP Extensions for Distributed Authoring -- WEBDAV. Y. Goland,
     E. Whitehead, A. Faizi, S. Carter, D. Jensen. February 1999.
\item[2616] Hypertext Transfer Protocol -- HTTP/1.1. R. Fielding, J. Gettys,
     J. Mogul, H. Frystyk, L. Masinter, P. Leach, T. Berners-Lee. June
     1999. (Obsoletes
     RFC2068) (Updated by RFC2817)
\item[2818] HTTP Over TLS. E. Rescorla. May 2000.
\end{list2}

\begin{quote}
HTTP er basalt set en sessionsløs protokol bestående at individuelle
HTTP forespørgsler via TCP forbindelser
\end{quote}

\slide{Infokager og state management}
\begin{list2}
\item[2109] HTTP State Management Mechanism. D. Kristol, L. Montulli.
     February 1997. (Format: TXT=43469 bytes) (Obsoleted by RFC2965)
     (Status: PROPOSED STANDARD)
\item[2965] HTTP State Management Mechanism. D. Kristol, L. Montulli. October
     2000. (Format: TXT=56176 bytes) (Obsoletes RFC2109) (Status: PROPOSED
     STANDARD)
\end{list2}
\begin{quote}
1.  ABSTRACT
   This document specifies a way to create a stateful session with HTTP
   requests and responses.  It describes two new headers, Cookie and
   Set-Cookie, which carry state information between participating
   origin servers and user agents.  The method described here differs
   from Netscape's Cookie proposal, but it can interoperate with
   HTTP/1.0 user agents that use Netscape's method.  (See the HISTORICAL
   section.)
\end{quote}

(Citatet er fra RFC-2109)

\slide{Transport Layer Security}


\slidenext

\end{document}
