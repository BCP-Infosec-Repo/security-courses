\documentclass[Screen16to9,17pt]{foils}
\usepackage{zencurity-slides}

\externaldocument{communication-and-network-security-exercises}
\selectlanguage{english}

\begin{document}

\mytitlepage
{DNS and Email Security}
{Communication and Network Security 2019}


\slide{Basal DNS opsætning}


\slide{Plan for today}

\begin{list1}
\item Subjects
\begin{list2}
\item
\end{list2}
\item Exercises
\begin{list2}
\item
\end{list2}
\end{list1}

\begin{alltt}
domain security6.net
nameserver 212.242.40.3
nameserver 212.242.40.51
nameserver 2001:1448:81:30::2
\end{alltt}

\begin{list1}
\item \verb+/etc/resolv.conf+ angiver navneservere og søgedomæner
\item typisk indhold er domænenavn og IP-adresser for navneservere
\item Filen opdateres også automatisk på DHCP klienter
\item {\bf Husk at man godt kan slå AAAA records op over IPv4}
\item NB: denne fil kan hedde noget andet på UNIX varianter!
\item eksempelvis \verb+/etc/netsvc.conf+
\end{list1}

\slide{DNS systemet}

\begin{list1}
\item Navneopslag på Internet - centralt for IPv6
\item Tidligere brugte man en {\bfseries hosts} fil\\
hosts filer bruges stadig lokalt til serveren - IP-adresser
\item UNIX: /etc/hosts
\item Windows \verb+c:\windows\system32\drivers\etc\hosts+
\item Eksempel: www.security6.net har adressen 217.157.20.131
\item skrives i database filer, zone filer
\end{list1}

\begin{alltt}
ns1     IN      A       217.157.20.130
        IN      AAAA    2001:618:433::1
www     IN      A       217.157.20.131
        IN      AAAA    2001:618:433::14
\end{alltt}

\slide{Mere end navneopslag}

\begin{list1}
  \item består af resource records med en type:
    \begin{list2}
\item adresser A-records
\item IPv6 adresser AAAA-records
\item autoritative navneservere NS-records
\item post, mail-exchanger MX-records
\item flere andre: md ,  mf ,  cname ,  soa ,
                  mb , mg ,  mr ,  null ,  wks ,  ptr ,
                  hinfo ,  minfo ,  mx ....
\end{list2}
\end{list1}
\begin{alltt}
        IN      MX      10      mail.security6.net.
        IN      MX      20      mail2.security6.net.
\end{alltt}



\exercise{ex:basic-dns-lookup}




\slide{BIND DNS server}

\begin{list1}
\item Berkeley Internet Name Daemon server
\item Mange bruger BIND fra Internet Systems Consortium
   - altså Open Source
\item konfigureres gennem \verb+named.conf+
\item det anbefales at bruge BIND version 9
\end{list1}

\begin{list2}
\item \emph{DNS and BIND}, Paul Albitz \& Cricket Liu, O'Reilly, 4th
  edition Maj 2001
\item \emph{DNS and BIND cookbook}, Cricket Liu, O'Reilly, 4th
  edition Oktober 2002
\end{list2}

Kilde: \link{http://www.isc.org}

\slide{BIND konfiguration - et udgangspunkt}

\begin{alltt}
\small
acl internals \{ 127.0.0.1; ::1; 10.0.0.0/24; \};
options \{
        // the random device depends on the OS !
        random-device "/dev/random"; directory "/namedb";
        {\bf listen-on-v6 { any; };}
        port 53; version "Dont know"; allow-query \{ any; \};
\};
view "internal" \{
   match-clients \{ internals; \}; recursion yes;
   zone "." \{
       type hint;   file "root.cache"; \};
   // localhost forward lookup
   zone "localhost." \{
        type master; file "internal/db.localhost";   \};
   // localhost reverse lookup from IPv4 address
   zone "0.0.127.in-addr.arpa" \{
        type master; file "internal/db.127.0.0"; notify no;   \};
...
\}
\end{alltt}

\slide{Moderne administration}


\link{https://labs.ripe.net/Members/ondrej_caletka/managing-dns-zones-using-git}

Lyder måske ikke moderne, men Git giver mulighed for signering mv.


\slide{SMTP Simple Mail Transfer Protocol}

\begin{alltt}\tiny
hlk@bigfoot:hlk$ telnet mail.kramse.dk 25
Connected to sunny.
220 sunny.kramse.dk ESMTP Postfix
HELO bigfoot
250 sunny.kramse.dk
MAIL FROM: Henrik
250 Ok
RCPT TO: hlk@kramse.dk
250 Ok
DATA
354 End data with <CR><LF>.<CR><LF>
hejsa
.
250 Ok: queued as 749193BD2
QUIT
221 Bye
\end{alltt}

\begin{list1}
\item RFC-821 SMTP Simple Mail Transfer Protocol fra 1982
\item RFC-2821 fra 2001 og flere andre er idag gældende
\item \link{http://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol}
\item Vedhæftede filer kodes i MIME Multipurpose Internet Mail Extensions
\item Bemærk at MIME encoding forøger størrelsen med ca. 30\%!
%\item Lad VÆRE med at sende store filer, dvs over 7-8MB via e-mail
\end{list1}

\slide{e-mail servere}

\begin{list1}
  \item Sendmail, qmail og postfix
\item Tre meget brugte e-mail systemer
  \begin{list2}
    \item Sendmail - den ældste og mest benyttede
\item Postfix en modulært og sikkerhedsmæssigt god e-mail server\\
er ligeledes nem at konfigurere
\item Qmail - en underlig mailserver lavet af Dan J Bernstein, med en
  speciel licens - ligesom programmøren
  \end{list2}
\item Dertil kommer diverse andre mailservere:
\item Microsoft Exchange på Windows servere
\item Jeg anbefaler at man har en postserver mod internet, der kun sender og modtager ekstern post, og en intern postserver der opbevarer al posten
\end{list1}


\slide{Postfix postserveren}

\hlkimage{6cm}{postfix-mouse.png}

\begin{list1}
\item Lavet af Wietse Venema for IBM
\item Nem at konfigurere og sikker
\item \verb+main.cf+ findes typisk i kataloget \verb+/etc/postfix+
\end{list1}

\slide{Audit af postservere}

\begin{list1}
\item Typisk findes konfigurationsfilerne til postservere under
  \verb+/etc+
\begin{list2}
\item \verb+/etc/mail+
\item \verb+/etc/postfix+
\end{list2}
\item Det vigtigste er at den er opdateret og IKKE tillader relaying
\item Der findes diverse test-scripts til relaycheck på internet
\item Husk også at checke domæne records, MX og A
\end{list1}

\slide{Test af e-mail server}

\begin{alltt}
[hlk]$ {\bfseries telnet localhost 25}
Connected.
Escape character is '^]'.
220 server ESMTP Postfix
{\bfseries helo test}
250 server
{\bfseries mail from: postmaster@pentest.dk}
250 Ok
{\bfseries rcpt to: root@pentest.dk}
250 Ok
{\bfseries data}
354 End data with <CR><LF>.<CR><LF>
{\bfseries skriv en kort besked}
.
250 Ok: queued as 91AA34D18
{\bfseries quit}
\end{alltt}
%$
\exercise{ex:email-server-config}

\slide{Postservere til klienter}

\begin{list1}
\item SMTP  som vi har gennemgået er til at sende mail mellem servere
\item Når vi skal hente post sker det typisk med POP3 eller IMAP
\begin{list2}
\item POP3 Post Office Protocol version 3 RFC-1939
\item Internet Message Access Protocol (typisk IMAPv4) RFC-3501
\end{list2}
\item Forskellen mellem de to er at man typisk med POP3 henter posten, hvor man med IMAP lader den ligge på serveren
\item POP3 er bedst hvis kun en klient skal hente
\item IMAP er bedst hvis du vil tilgå din post fra flere systemer
\item Jeg bruger selv IMAPS, IMAP over SSL kryptering - idet kodeord ellers sendes i klartekst
\end{list1}


\slide{POP3 i Danmark}

\hlkimage{15cm}{images/pop3-1.pdf}

\begin{list1}
\item Man har tillid til sin ISP - der administrerer såvel net som server
\end{list1}

\slide{POP3 i Danmark - trådløst}

\hlkimage{13cm}{images/pop3-wlan.pdf}
\begin{list1}
\item Har man tillid til andre ISP'er? Alle ISP'er?
\item Deler man et netværksmedium med andre?
\item {\color{security6blue}Brug de rigtige protokoller!}
\end{list1}


\slidenext

\end{document}
